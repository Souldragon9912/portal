<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Links Dashboard</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#111;
  color:white;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.container{
  background:rgba(0,0,0,0.6);
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:900px;
}

.category{
  margin-bottom:20px;
}

.category-header{
  font-size:20px;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  gap:10px;
}

.link-grid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(120px,1fr));
  gap:15px;
}

.link-box{
  background:#222;
  padding:10px;
  border-radius:10px;
  text-align:center;
  color:white;
  text-decoration:none;
  position:relative;
}

.link-box img{
  width:36px;
  height:36px;
}

.popup{
  position:fixed;
  top:0;left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.8);
  display:none;
  justify-content:center;
  align-items:center;
}

.popupContent{
  background:#222;
  padding:20px;
  border-radius:10px;
  width:90%;
  max-width:500px;
}

button{
  margin-top:10px;
  padding:8px;
  border:none;
  border-radius:6px;
  background:#4CAF50;
  color:white;
  cursor:pointer;
}

.cancel{
  background:#555;
}
</style>
</head>

<body>

<div class="container">
  <h1>My Dashboard</h1>
  <div id="categories"></div>
</div>

<button id="settingsBtn" style="position:fixed;bottom:20px;right:20px;width:50px;height:50px;border-radius:50%;">⚙️</button>

<!-- SETTINGS MENU -->
<div id="settingsPopup" class="popup">
  <div class="popupContent">
    <h2>Settings</h2>

    <label>Icon Size</label>
    <input type="range" id="iconSizeSlider" min="30" max="80" value="36">

    <h3>Links</h3>
    <button id="addLinkBtn">Add Link</button>
    <button id="manageLinksBtn">Manage Links</button>

    <h3>Background</h3>
    <input type="file" id="bgFile">
    <input type="text" id="bgURL" placeholder="Image URL or color">
    <button id="saveBg">Save Background</button>

    <button id="closeSettings" class="cancel">Close</button>
  </div>
</div>

<!-- ADD LINK POPUP -->
<div id="addPopup" class="popup">
  <div class="popupContent">
    <h2>Add Link</h2>
    <input id="newName" placeholder="Name"><br>
    <input id="newURL" placeholder="URL"><br>
    <input id="newCategory" placeholder="Category"><br>

    <button id="saveLink">Save</button>
    <button id="cancelAdd" class="cancel">Cancel</button>
  </div>
</div>

<!-- MANAGE LINKS POPUP -->
<div id="manageLinksPopup" class="popup">
  <div class="popupContent">
    <h2>Manage Links</h2>
    <div id="linksManagerList"></div>
    <button id="closeManageLinks" class="cancel">Close</button>
  </div>
</div>

<script>
let links = JSON.parse(localStorage.getItem("links")) || [
  {name:"MyUNOH", url:"https://my.unoh.edu", category:"School"},
  {name:"Canvas", url:"https://canvas.unoh.edu", category:"School"},
  {name:"The Verge", url:"https://theverge.com", category:"Tech News"}
];

function saveLinks(){
  localStorage.setItem("links", JSON.stringify(links));
}

function renderLinks(){
  const container = document.getElementById("categories");
  container.innerHTML="";

  const categories = [...new Set(links.map(l=>l.category))];

  categories.forEach(cat=>{
    const section = document.createElement("div");
    section.className="category";

    section.innerHTML=`<div class="category-header">${cat}</div>
    <div class="link-grid"></div>`;

    const grid = section.querySelector(".link-grid");

    links.filter(l=>l.category===cat).forEach(link=>{
      const a = document.createElement("a");
      a.href=link.url;
      a.target="_blank";
      a.className="link-box";

      const icon = document.createElement("img");
      icon.src=`https://www.google.com/s2/favicons?domain=${link.url}`;

      const label = document.createElement("div");
      label.textContent=link.name;

      a.appendChild(icon);
      a.appendChild(label);

      grid.appendChild(a);
    });

    container.appendChild(section);
  });

  applyIconSize();
}

renderLinks();

const settingsBtn=document.getElementById("settingsBtn");
const settingsPopup=document.getElementById("settingsPopup");
const closeSettings=document.getElementById("closeSettings");

settingsBtn.onclick=()=>settingsPopup.style.display="flex";
closeSettings.onclick=()=>settingsPopup.style.display="none";

// ADD LINK
document.getElementById("addLinkBtn").onclick=()=>{
  document.getElementById("addPopup").style.display="flex";
};

document.getElementById("cancelAdd").onclick=()=>{
  document.getElementById("addPopup").style.display="none";
};

document.getElementById("saveLink").onclick=()=>{
  links.push({
    name:newName.value,
    url:newURL.value,
    category:newCategory.value
  });

  saveLinks();
  renderLinks();
  document.getElementById("addPopup").style.display="none";
};

// MANAGE LINKS
const manageLinksBtn=document.getElementById("manageLinksBtn");
const managePopup=document.getElementById("manageLinksPopup");
const managerList=document.getElementById("linksManagerList");

manageLinksBtn.onclick=openManageLinks;

function openManageLinks(){
  managerList.innerHTML="";

  links.forEach((link,i)=>{
    const div=document.createElement("div");
    div.style.marginBottom="10px";

    div.innerHTML=`
      <input id="n${i}" value="${link.name}"><br>
      <input id="u${i}" value="${link.url}"><br>
      <input id="c${i}" value="${link.category}"><br>

      <button onclick="saveEdit(${i})">Save</button>
      <button style="background:red" onclick="deleteLink(${i})">Delete</button>
    `;

    managerList.appendChild(div);
  });

  managePopup.style.display="flex";
}

document.getElementById("closeManageLinks").onclick=()=>{
  managePopup.style.display="none";
};

window.saveEdit=function(i){
  links[i]={
    name:document.getElementById("n"+i).value,
    url:document.getElementById("u"+i).value,
    category:document.getElementById("c"+i).value
  };

  saveLinks();
  renderLinks();
  openManageLinks();
}

window.deleteLink=function(i){
  if(!confirm("Delete this link?"))return;

  links.splice(i,1);
  saveLinks();
  renderLinks();
  openManageLinks();
}

// ICON SIZE
const slider=document.getElementById("iconSizeSlider");

function applyIconSize(){
  const size=localStorage.getItem("iconSize") || 36;

  document.querySelectorAll(".link-box img").forEach(img=>{
    img.style.width=size+"px";
    img.style.height=size+"px";
  });

  slider.value=size;
}

slider.oninput=()=>{
  localStorage.setItem("iconSize", slider.value);
  applyIconSize();
};

applyIconSize();

// BACKGROUND
let bgData=null;

document.getElementById("bgFile").onchange=(e)=>{
  const reader=new FileReader();
  reader.onload=(ev)=>{
    bgData=ev.target.result;
    setBackground(bgData);
  };
  reader.readAsDataURL(e.target.files[0]);
};

document.getElementById("saveBg").onclick=()=>{
  const url=document.getElementById("bgURL").value;

  if(bgData) setBackground(bgData);
  else if(url) setBackground(url);

  settingsPopup.style.display="none";
};

function setBackground(bg){
  if(bg.startsWith("data")||bg.startsWith("http")){
    document.body.style.backgroundImage=`url(${bg})`;
    document.body.style.backgroundSize="cover";
  } else {
    document.body.style.background=bg;
  }

  localStorage.setItem("bg",bg);
}

const savedBg=localStorage.getItem("bg");
if(savedBg) setBackground(savedBg);

</script>
</body>
</html>
